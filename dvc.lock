schema: '2.0'
stages:
  compose:
    cmd: python src/compose.py
    deps:
    - path: src/compose.py
      hash: md5
      md5: 734de3875c6f0a8e4f36d1d039730544
      size: 699
    - path: src/data_transformer.py
      hash: md5
      md5: 5e0d2c76aec3be8a435cc665206c123a
      size: 23956
    - path: src/datasets.py
      hash: md5
      md5: 591e8df16f7bc813dabbf76f5f40eb66
      size: 606
    - path: src/utils.py
      hash: md5
      md5: f6ab57ee0ed26060ce79bb78c23db55e
      size: 1601
    params:
      params.yaml:
        compose:
          dataset: lab_data
          output: data.pkl
        metadata:
          label_column: acc_gyro_event
          timestamp_column: acc_gyro_timestamp
          correct_labels:
          - 0
          - 1
          - 2
          - 4
          - 8
          timestamp_multiplier: 0.0001
          signal_columns:
            acc:
            - acc_x
            - acc_y
            - acc_z
            gyro:
            - gyro_x
            - gyro_y
            - gyro_z
          scalar_columns:
          - patient_id
          - measure_id
          - augmented
          datetime_column: packet_start_time
          patient_column: patient_id
          measure_column: measure_id
          augment_column: augmented
    outs:
    - path: data/data.pkl
      hash: md5
      md5: 2984ed34c838b39c92bb0653cd21d549
      size: 429301096
  prepare:
    cmd: python src/prepare.py
    deps:
    - path: data/data.pkl
      hash: md5
      md5: 2984ed34c838b39c92bb0653cd21d549
      size: 429301096
    - path: src/data_transformer.py
      hash: md5
      md5: 5e0d2c76aec3be8a435cc665206c123a
      size: 23956
    - path: src/prepare.py
      hash: md5
      md5: a5aa152a2fd1b8c7f2d12e06681afeb4
      size: 6483
    - path: src/utils.py
      hash: md5
      md5: f6ab57ee0ed26060ce79bb78c23db55e
      size: 1601
    params:
      params.yaml:
        metadata:
          label_column: acc_gyro_event
          timestamp_column: acc_gyro_timestamp
          correct_labels:
          - 0
          - 1
          - 2
          - 4
          - 8
          timestamp_multiplier: 0.0001
          signal_columns:
            acc:
            - acc_x
            - acc_y
            - acc_z
            gyro:
            - gyro_x
            - gyro_y
            - gyro_z
          scalar_columns:
          - patient_id
          - measure_id
          - augmented
          datetime_column: packet_start_time
          patient_column: patient_id
          measure_column: measure_id
          augment_column: augmented
        prepare:
          output: data_prepared.pkl
          window_size: 700
          window_step: 100
          random_seed: 42
          augment_percent: 100
          augment_params:
            sigma: 5
          augmenter: None
          partial_windows: false
          subsample: false
    outs:
    - path: data/data_prepared.pkl
      hash: md5
      md5: 457e30030e42049eb2800d6ac406b947
      size: 2414582692
  diagrams:
    cmd: python src/diagrams.py
    deps:
    - path: data/data_prepared.pkl
      hash: md5
      md5: 457e30030e42049eb2800d6ac406b947
      size: 2414582692
    - path: src/data_transformer.py
      hash: md5
      md5: 5e0d2c76aec3be8a435cc665206c123a
      size: 23956
    - path: src/diagrams.py
      hash: md5
      md5: e8c67287953c4fbe2586c1c8d70dfe34
      size: 4708
    - path: src/utils.py
      hash: md5
      md5: 9ab1831186b26fc602f4b406f4d6cd60
      size: 1043
    params:
      params.yaml:
        diagrams:
          output: diagrams.pkl
          restrict: 500
          columns:
            xy:
            - acc_x
            - acc_y
            xz:
            - acc_x
            - acc_z
            yz:
            - acc_y
            - acc_z
          params:
          - dim: 2
          - dim: 3
          - dim: 4
          - dim: 10
          - dim: 2
            kind: abs
          - dim: 10
            kind: abs
          - dim: 2
            kind: phi
          - dim: 10
            kind: phi
          - dim: 2
            kind: abs
            fil: star
          - dim: 2
            kind: phi
            fil: star
          - dim: 2
            step: 30
          - dim: 4
            step: 30
        metadata:
          label_column: acc_gyro_event
          timestamp_column: acc_gyro_timestamp
          correct_labels:
          - 0
          - 1
          - 2
          - 4
          - 8
          timestamp_multiplier: 0.0001
          signal_columns:
            acc:
            - acc_x
            - acc_y
            - acc_z
            gyro:
            - gyro_x
            - gyro_y
            - gyro_z
          scalar_columns:
          - patient_id
          - measure_id
          - augmented
          datetime_column: packet_start_time
          patient_column: patient_id
          measure_column: measure_id
          augment_column: augmented
    outs:
    - path: data/diagrams.pkl
      hash: md5
      md5: 6c0300e025fb8ed4587b60fe12bd8604
      size: 1127495516
  featurize:
    cmd: python src/featurize.py
    deps:
    - path: data/diagrams.pkl
      hash: md5
      md5: 6c0300e025fb8ed4587b60fe12bd8604
      size: 1127495516
    - path: src/data_transformer.py
      hash: md5
      md5: 5e0d2c76aec3be8a435cc665206c123a
      size: 23956
    - path: src/feature_list.py
      hash: md5
      md5: 605fdd9ad0fe55d69207ec5ea6a29048
      size: 8815
    - path: src/featurize.py
      hash: md5
      md5: 106d03f4ee9af7319c218b25a32ea092
      size: 3938
    - path: src/utils.py
      hash: md5
      md5: f6ab57ee0ed26060ce79bb78c23db55e
      size: 1601
    params:
      params.yaml:
        featurize:
          output: features.pkl
        metadata:
          label_column: acc_gyro_event
          timestamp_column: acc_gyro_timestamp
          correct_labels:
          - 0
          - 1
          - 2
          - 4
          - 8
          timestamp_multiplier: 0.0001
          signal_columns:
            acc:
            - acc_x
            - acc_y
            - acc_z
            gyro:
            - gyro_x
            - gyro_y
            - gyro_z
          scalar_columns:
          - patient_id
          - measure_id
          - augmented
          datetime_column: packet_start_time
          patient_column: patient_id
          measure_column: measure_id
          augment_column: augmented
    outs:
    - path: data/features.pkl
      hash: md5
      md5: 770e6ac03abc8b27555137d13db3208c
      size: 6799150
  rfe_reduce:
    cmd: python src/rfe_reduce.py
    deps:
    - path: data/train_features.pkl
      hash: md5
      md5: 4a5aabff2a3276454a6d05be013ca50c
      size: 5442148
    - path: src/ml_utils.py
      hash: md5
      md5: b30611129895c10c3dc3498834697abd
      size: 4281
    - path: src/rfe_reduce.py
      hash: md5
      md5: 2540bb9a31c2ce09ffb979adcbdf4554
      size: 4991
    - path: src/utils.py
      hash: md5
      md5: 9ab1831186b26fc602f4b406f4d6cd60
      size: 1043
    params:
      params.yaml:
        metadata:
          label_column: acc_gyro_event
          timestamp_column: acc_gyro_timestamp
          correct_labels:
          - 0
          - 1
          - 2
          - 4
          - 8
          timestamp_multiplier: 0.0001
          signal_columns:
            acc:
            - acc_x
            - acc_y
            - acc_z
            gyro:
            - gyro_x
            - gyro_y
            - gyro_z
          scalar_columns:
          - patient_id
          - measure_id
          - augmented
          datetime_column: packet_start_time
          patient_column: patient_id
          measure_column: measure_id
          augment_column: augmented
        rfe_reduce:
          input: train_features.pkl
          output: features_rank.pkl
          rfecv_output: rfecv_results.pkl
          cycles_to_run: 1
          rfe_groups: false
          random_seed: 0
          restrict: 200
    outs:
    - path: data/features_rank.pkl
      hash: md5
      md5: a6ad43c55063b558cfcc47ad377d8cc0
      size: 14891
    - path: data/rfecv_results.pkl
      hash: md5
      md5: 5b5178901fb539b1d0eef90535f2bed0
      size: 25691106
  train_test_split:
    cmd: python src/train_test_split.py
    deps:
    - path: data/features.pkl
      hash: md5
      md5: 770e6ac03abc8b27555137d13db3208c
      size: 6799150
    - path: src/train_test_split.py
      hash: md5
      md5: 5d14c1d130e8c323a9f37ac9b1127dd3
      size: 1896
    - path: src/utils.py
      hash: md5
      md5: f6ab57ee0ed26060ce79bb78c23db55e
      size: 1601
    params:
      params.yaml:
        metadata:
          label_column: acc_gyro_event
          timestamp_column: acc_gyro_timestamp
          correct_labels:
          - 0
          - 1
          - 2
          - 4
          - 8
          timestamp_multiplier: 0.0001
          signal_columns:
            acc:
            - acc_x
            - acc_y
            - acc_z
            gyro:
            - gyro_x
            - gyro_y
            - gyro_z
          scalar_columns:
          - patient_id
          - measure_id
          - augmented
          datetime_column: packet_start_time
          patient_column: patient_id
          measure_column: measure_id
          augment_column: augmented
        train_test_split:
          training_output: train_features.pkl
          test_output: test_features.pkl
          test_proportion: 0.2
    outs:
    - path: data/test_features.pkl
      hash: md5
      md5: 710b8012825071f32915a8927810c991
      size: 1371146
    - path: data/train_features.pkl
      hash: md5
      md5: 4a5aabff2a3276454a6d05be013ca50c
      size: 5442148
  crossvalidate:
    cmd: python src/crossvalidate.py
    deps:
    - path: data/features_rank.pkl
      hash: md5
      md5: a6ad43c55063b558cfcc47ad377d8cc0
      size: 14891
    - path: data/train_features.pkl
      hash: md5
      md5: 4a5aabff2a3276454a6d05be013ca50c
      size: 5442148
    - path: src/crossvalidate.py
      hash: md5
      md5: 99fde470ed7d660e2ebb15d5f199027d
      size: 4681
    - path: src/ml_utils.py
      hash: md5
      md5: d7bb2bcb378079cd00d846125afc3101
      size: 8560
    - path: src/utils.py
      hash: md5
      md5: f6ab57ee0ed26060ce79bb78c23db55e
      size: 1601
    params:
      params.yaml:
        crossvalidate:
          random_seed: 42
          features: 100
          output: crossval_results.json
        metadata:
          label_column: acc_gyro_event
          timestamp_column: acc_gyro_timestamp
          correct_labels:
          - 0
          - 1
          - 2
          - 4
          - 8
          timestamp_multiplier: 0.0001
          signal_columns:
            acc:
            - acc_x
            - acc_y
            - acc_z
            gyro:
            - gyro_x
            - gyro_y
            - gyro_z
          scalar_columns:
          - patient_id
          - measure_id
          - augmented
          datetime_column: packet_start_time
          patient_column: patient_id
          measure_column: measure_id
          augment_column: augmented
        model:
          name: rf
          n_estimators: 500
          criterion: gini
          max_depth:
          max_features: sqrt
          max_leaf_nodes:
          min_impurity_decrease: 0.0
          min_samples_leaf: 1
          min_samples_split: 2
          min_weight_fraction_leaf: 0.0
          max_samples:
          oob_score: false
          ccp_alpha: 0.0
    outs:
    - path: metrics/crossval_results.json
      hash: md5
      md5: a0e2defc77fc49ff05a34b7150324bda
      size: 574
